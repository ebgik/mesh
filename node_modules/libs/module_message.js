var db = require('libs/module_db');


exports.addMessage = function(id_sender,message,callback) {
	var query = db.query('INSERT INTO message SET id_sender = ?, message = ?',[id_sender, message], 
		function(err, result) {
		  if (err)
		  	callback(err);
		  else 
		  	callback('success');
		});
}


exports.getMessages = function(count,callback){
	var counter = db.query('SELECT COUNT(*) FROM message',function(errCount,resCount){
		if (errCount) callback(err,'none');
		else
		{
			if (resCount[0]['COUNT(*)']<20)
				start = 1;
			else
			var start = resCount[0]['COUNT(*)']-count;

			var query = db.query('SELECT M.*, U.name FROM message AS M, users AS U WHERE M.id_sender = U.id LIMIT ?,?',
			[start,count],function(err,result){
				if (result)
					callback(err,result);
				else
					callback(err,'none');
			});
		}
		
	})
	
}